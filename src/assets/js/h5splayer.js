function createRTCSessionDescription(t){return new RTCSessionDescription(t)}var gStrH5SPlayerVersion="h5splayer r18.0.0823.2024";console.log("[h5s]",gStrH5SPlayerVersion);var gH5SOffer="v=0\r\no=- 4855078920460860878 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\na=group:BUNDLE 0\r\na=extmap-allow-mixed\r\na=msid-semantic: WMS 83ff--35video_label\r\nm=video 9 UDP/TLS/RTP/SAVPF 125 124 100 101 127\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\na=ice-ufrag:PgLG\r\na=ice-pwd:O99ZdgQQ+94aOP0UYaMs1dWK\r\na=ice-options:trickle\r\na=fingerprint:sha-256 0A:3F:64:EA:CE:3C:B9:43:08:4B:8B:4C:85:7F:6C:DC:73:30:94:7E:1F:A4:9C:1F:63:69:74:07:25:AB:14:3A\r\na=setup:actpass\r\na=mid:0\r\na=extmap:1 urn:ietf:params:rtp-hdrext:toffset\r\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\r\na=extmap:3 urn:3gpp:video-orientation\r\na=extmap:4 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\r\na=extmap:5 http://www.webrtc.org/experiments/rtp-hdrext/playout-delay\r\na=extmap:6 http://www.webrtc.org/experiments/rtp-hdrext/video-content-type\r\na=extmap:7 http://www.webrtc.org/experiments/rtp-hdrext/video-timing\r\na=extmap:8 http://www.webrtc.org/experiments/rtp-hdrext/color-space\r\na=extmap:9 urn:ietf:params:rtp-hdrext:sdes:mid\r\na=extmap:10 urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id\r\na=extmap:11 urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id\r\na=sendonly\r\na=msid:83ff--35video_label video_label\r\na=rtcp-mux\r\na=rtcp-rsize\r\na=rtpmap:125 H265/90000\r\na=rtcp-fb:125 goog-remb\r\na=rtcp-fb:125 transport-cc\r\na=rtcp-fb:125 ccm fir\r\na=rtcp-fb:125 nack\r\na=rtcp-fb:125 nack pli\r\na=rtpmap:124 rtx/90000\r\na=fmtp:124 apt=125\r\na=rtpmap:100 red/90000\r\na=rtpmap:101 rtx/90000\r\na=fmtp:101 apt=100\r\na=rtpmap:127 ulpfec/90000\r\na=ssrc-group:FID 891420707 251370098\r\na=ssrc:891420707 cname:Z7P5xn6vR3vHWXgv\r\na=ssrc:891420707 msid:83ff--35video_label video_label\r\na=ssrc:251370098 cname:Z7P5xn6vR3vHWXgv\r\na=ssrc:251370098 msid:83ff--35video_label video_label\r\n";async function H5SIsWebrtcH265ReceiveCodecSupported(){try{const t=gH5SOffer,e=new RTCPeerConnection({iceServers:[]});await e.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:t}));const s=await e.createAnswer();return JSON.stringify(s).search("H265")>=0}catch(t){return!1}}var gH5SIsWebrtcH265ReceiveCodecSupported=!1,gH5SIsWebrtcInit=!1;function H5sPlayerWS(t){this.sourceBuffer,this.buffer=[],this.t,this.video,this.s,this.i,this.o,this.h=0,this.l=0,this.u=0,this.S=!1,this.v=!1,this.C=!1,this.p,this.H=1,this.P=!0,void 0!==t.consolelog&&"false"===t.consolelog&&(this.P=!1),this.m=t,!0===this.P&&console.log("[WS] Websocket Conf:",t),this.R=t.videoid,this.k=t.pbconf,this.W=t.token,void 0===this.R?(this.T=t.videodom,!0===this.P&&console.log("[WS] use dom directly",t.token)):(this.T=document.getElementById(this.R),!0===this.P&&console.log("[WS] use videoid",t.token)),void 0!=this.T.I&&(!0===this.P&&console.log("[WS] set latencyHint to 0"),this.T.I=0),this.video=this.T,this.A,void 0!=this.k&&"false"==this.k.showposter?(this.A=this.m.protocol+"//"+this.m.host+this.m.rootpath+"api/v1/GetLoadingImage?session="+this.m.session+"&refresh="+Math.floor(1e6*Math.random()),!0===this.P&&console.log("[WS] connect src",t.token),this.T.setAttribute("poster",this.A)):(this.A=this.m.protocol+"//"+this.m.host+this.m.rootpath+"api/v1/GetImage?token="+this.W+"&session="+this.m.session+"&refresh="+Math.floor(1e6*Math.random()),!0===this.P&&console.log("[WS] connect src",t.token),this.T.setAttribute("poster",this.A))}function H5sPlayerRTC(t){this.s,this.o,this.S=!1,this.v=!1,this.P=!0,void 0!==t.consolelog&&"false"===t.consolelog&&(this.P=!1),this.m=t,this.R=t.videoid,this.k=t.pbconf,this.W=t.token,this.H=1,void 0===this.R?(this.T=t.videodom,!0===this.P&&console.log("[RTC] use dom directly",t.token)):(this.T=document.getElementById(this.R),!0===this.P&&console.log("[RTC] use videoid",t.token)),this.video=this.T,this.g=null,this.M={optional:[{DtlsSrtpKeyAgreement:!0}]},this.U={mandatory:{offerToReceiveAudio:!0,offerToReceiveVideo:!0}},this.O={iceServers:[]},this.N=[],this.A,void 0!=this.k&&"false"==this.k.showposter?(this.A=this.m.protocol+"//"+this.m.host+this.m.rootpath+"api/v1/GetLoadingImage?session="+this.m.session+"&refresh="+Math.floor(1e6*Math.random()),!0===this.P&&console.log("[WS] connect src",t.token),this.T.setAttribute("poster",this.A)):(this.A=this.m.protocol+"//"+this.m.host+this.m.rootpath+"api/v1/GetImage?token="+this.W+"&session="+this.m.session+"&refresh="+Math.floor(1e6*Math.random()),!0===this.P&&console.log("[WS] connect src",t.token),this.T.setAttribute("poster",this.A)),this.F=new MediaStream}function H5sPlayerHls(t){this.s,this.o,this.m=t,this.R=t.videoid,this.W=t.token,this.J,this._=t.hlsver,this.P=!0,void 0!==t.consolelog&&"false"===t.consolelog&&(this.P=!1),void 0===this.R?(this.T=t.videodom,!0===this.P&&console.log("[HLS] use dom directly",t.token)):(this.T=document.getElementById(this.R),!0===this.P&&console.log("[HLS] use videoid",t.token)),this.D=this.T,this.D.type="application/x-mpegURL",this.L=0,this.B=0;var e=this.m.protocol+"//"+window.location.host+"/api/v1/GetImage?token="+this.W+"&session="+this.m.session;this.T.setAttribute("poster",e)}function H5sPlayerAudio(t){this.buffer=[],this.s,this.S=!1,this.v=!1,this.m=t,this.P=!0,void 0!==t.consolelog&&"false"===t.consolelog&&(this.P=!1),!0===this.P&&console.log("[AUD] Aduio Player Conf:",t),this.W=t.token,this.V=new AudioContext}function H5sPlayerAudBack(t){this.buffer=[],this.s,this.S=!1,this.v=!1,this.m=t,this.K=0,this.G=48e3,this.Z=!1,this.P=!0,void 0!==t.consolelog&&"false"===t.consolelog&&(this.P=!1),!0===this.P&&console.log("[AUDBACK] Aduio Back Conf:",t),this.W=t.token,this.V=new AudioContext,!0===this.P&&console.log("[AUDBACK] sampleRate",this.V.sampleRate),this.X()}function float32ToInt16(t){for(var e=t.length,s=new Int16Array(e);e--;)s[e]=32767*Math.min(1,t[e]);return s}function H5sConference(t){this.s,this.o,this.S=!1,this.v=!1,this.Y=!1,this.j,this.q,this.$=!1,this.tt=!1,this.et,this.st,this.it=[],this.ot=[],this.P=!0,void 0!==t.consolelog&&"false"===t.consolelog&&(this.P=!1),void 0!==t.nt&&"true"===t.nt&&(this.$=!0),void 0!==t.ht&&"true"===t.ht&&(this.tt=!0),this.m=t,void 0===t.localvideoid?(this.ct=t.localvideodom,!0===this.P&&console.log(t.token,"[CFE] local use dom directly")):(this.ct=document.getElementById(t.localvideoid),!0===this.P&&console.log(t.token,"[CFE] local use videoid")),void 0===t.remotevideoid?(this.rt=t.remotevideodom,!0===this.P&&console.log(t.token,"[CFE] remote use dom directly")):(this.rt=document.getElementById(t.remotevideoid),!0===this.P&&console.log(t.token,"[CFE] remote use videoid")),this.g=null,this.M={optional:[{DtlsSrtpKeyAgreement:!0}]},this.U={mandatory:{offerToReceiveAudio:!0,offerToReceiveVideo:!0,at:!1}},this.O={iceServers:[]},this.N=[]}function makeLink(t,e,s){const i=new Blob(t,{type:"video/webm"}),o=window.URL.createObjectURL(i),n=document.createElement("a");n.style.display="none",n.href=o;const h=new Date;var c=e+"_"+h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate()+"-"+h.getHours()+"-"+h.getMinutes()+"-"+h.getSeconds()+s;n.download=c,document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(o)},100)}function H5sRTCPush(t){this.s,this.o,this.S=!1,this.v=!1,this.P=!0,void 0!==t.consolelog&&"false"===t.consolelog&&(this.P=!1),this.m=t,this.R=t.localvideoid,this.lt=t.user,this.H=1,void 0===this.R?(this.dt=t.localvideodom,!0===this.P&&console.log("[PUSH] use dom directly",t.user)):(this.dt=document.getElementById(this.R),!0===this.P&&console.log("[PUSH] use videoid",t.user)),this.video=this.dt,this.g=null,this.M={optional:[{DtlsSrtpKeyAgreement:!0}]},this.U={mandatory:{offerToReceiveAudio:!1,offerToReceiveVideo:!1}},this.O={iceServers:[]},this.N=[]}function H5sRTCGetCapability(t,s){var i={},o=[],n=[],h=[],c=[];if(navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(t){t&&t.getTracks().forEach(t=>{t.stop()})}).catch(function(t){var e="[PUSH] getUserMedia failed: "+t.name+" "+t.message;alert(e)}),window.RTCRtpTransceiver&&"setCodecPreferences"in window.RTCRtpTransceiver.prototype){const t=window.RTCRtpSender.getCapabilities("video").codecs;var r=!1,a=!1;for(let e=0;e!==t.length;++e){const s=t[e];["video/red","video/ulpfec","video/rtx"].includes(s.mimeType)||(["video/VP9"].includes(s.mimeType)?r=!0:["video/H264"].includes(s.mimeType)&&(a=!0))}1==r&&o.push("VP9"),1==a&&o.push("H264")}else o.push("Default");navigator.mediaDevices.enumerateDevices().then(function(e){for(let t=0;t!==e.length;++t){const i=e[t];var s={};s.id=i.deviceId,s.name=i.label,"audioinput"===i.kind?n.push(s):"audiooutput"===i.kind?h.push(s):"videoinput"===i.kind&&c.push(s)}i.videocodec=o,i.videoin=c,i.audioin=n,i.audioout=h,t(i)}).catch(function(t){alert("[PUSH] enumerateDevices failed",e)})}function H5sGetClientWSDecoder(){var t,e='video/mp4; codecs="avc1.42E01E, mp4a.40.2"';"MediaSource"in window&&MediaSource.isTypeSupported(e)&&(t="H264");e='video/mp4; codecs="hev1.1.6.L93.B0, mp4a.40.2"';return"MediaSource"in window&&MediaSource.isTypeSupported(e)&&(t+=" H265"),t}function H5sGetClientRTCDecoder(){var t;return t="H264",1==gH5SIsWebrtcH265ReceiveCodecSupported&&(t+=" H265"),t}function H5sGetClientRTCInit(){return gH5SIsWebrtcInit}H5SIsWebrtcH265ReceiveCodecSupported().then(t=>{gH5SIsWebrtcH265ReceiveCodecSupported=t,gH5SIsWebrtcInit=!0,console.log("[RTC] RTC init finished")}),H5sPlayerWS.prototype.ut=function(){if(!0===this.S){!0===this.P&&console.log("[WS] Reconnect...");var t=this.A+"&update="+this.H;this.T.setAttribute("poster",t),!0===this.P&&console.log("[WS] Reconnect image",t),this.H++,this.ft(this.W),this.S=!1}},H5sPlayerWS.prototype.St=function(t){var e;!0===this.P&&console.log("[WS] H5SWebSocketClient");try{"http:"==this.m.protocol&&(e="undefined"!=typeof MozWebSocket?new MozWebSocket("ws://"+this.m.host+t):new WebSocket("ws://"+this.m.host+t)),"https:"==this.m.protocol&&(!0===this.P&&console.log(this.m.host),e="undefined"!=typeof MozWebSocket?new MozWebSocket("wss://"+this.m.host+t):new WebSocket("wss://"+this.m.host+t)),!0===this.P&&console.log(this.m.host)}catch(t){return void alert("WebSocketClient error")}return e},H5sPlayerWS.prototype.vt=function(){if(null!==this.sourceBuffer&&void 0!==this.sourceBuffer){if(0!==this.buffer.length&&!this.sourceBuffer.updating)try{var t=this.buffer.shift(),e=new Uint8Array(t);this.sourceBuffer.appendBuffer(e)}catch(t){!0===this.P&&console.log(t),this.s.close()}}else!0===this.P&&console.log("[WS] is null or undefined",this.sourceBuffer)},H5sPlayerWS.prototype.Ct=function(){try{var t={cmd:"H5_KEEPALIVE"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerWS.prototype.pt=function(t){return t.data,ArrayBuffer,"string"==typeof t.data?(!0===this.P&&console.log("[WS] string"),void(void 0!=this.k&&void 0!=this.k.callback&&this.k.callback(t.data,this.k.userdata))):!0!==this.v?!1===this.C?(this.p=String.fromCharCode.apply(null,new Uint8Array(t.data)),this.Ht(this),void(this.C=!0)):(this.buffer.push(t.data),void this.vt()):void 0},H5sPlayerWS.prototype.Ht=function(t){try{window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource||!0===t.P&&console.log("[WS] MediaSource API is not available");var e='video/mp4; codecs="avc1.42E01E, mp4a.40.2"';"MediaSource"in window&&MediaSource.isTypeSupported(e)?!0===t.P&&console.log("[WS] MIME type or codec: ",e):!0===t.P&&console.log("[WS] Unsupported MIME type or codec: ",e),t.t=new window.MediaSource,t.video.autoplay=!0,!0===t.P&&console.log(t.R);t.video.src=window.URL.createObjectURL(t.t),t.t.addEventListener("sourceopen",t.yt.bind(t),!1)}catch(e){!0===t.P&&console.log(e)}},H5sPlayerWS.prototype.yt=function(){!0===this.P&&console.log("[WS] Add SourceBuffer"),this.sourceBuffer=this.t.addSourceBuffer(this.p),this.t.duration=1/0,this.t.removeEventListener("sourceopen",this.yt,!1),this.sourceBuffer.addEventListener("updateend",this.vt.bind(this),!1)},H5sPlayerWS.prototype.ft=function(t){if(this.video.autoplay=!0,window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource){var e="false",s='video/mp4; codecs="hev1.1.6.L93.B0, mp4a.40.2"';"MediaSource"in window&&MediaSource.isTypeSupported(s)?(!0===this.P&&console.log("[WS] MIME type or codec: ",s),e="true"):(!0===this.P&&console.log("[WS] Unsupported MIME type or codec: ",s),e="false");var i="api/v1/h5swsapi",o="main";if(void 0===this.m.streamprofile||(o=this.m.streamprofile),void 0===this.k)i=this.m.rootpath+i+"?token="+t+"&hevc="+e+"&profile="+o+"&session="+this.m.session;else{var n="false",h="fake";void 0===this.k.serverpb||(n=this.k.serverpb),void 0===this.k.filename||(h=this.k.filename);var c=this.k.begintime;void 0===this.k.moveto||(c=this.k.moveto),i=this.m.rootpath+i+"?token="+t+"&hevc="+e+"&playback=true&profile="+o+"&serverpb="+n+"&begintime="+encodeURIComponent(this.k.begintime)+"&endtime="+encodeURIComponent(this.k.endtime)+"&moveto="+encodeURIComponent(c)+"&filename="+h+"&session="+this.m.session}!0===this.P&&console.log(i),this.s=this.St(i),!0===this.P&&console.log("[WS] setupWebSocket",this.s),this.s.binaryType="arraybuffer",this.s.Pt=this,this.s.onmessage=this.pt.bind(this),this.s.onopen=function(){!0===this.Pt.P&&console.log("[WS] wsSocket.onopen",this.Pt),this.Pt.i=setInterval(this.Pt.wt.bind(this.Pt),1e4),this.Pt.o=setInterval(this.Pt.Ct.bind(this.Pt),1e3),void 0!=this.Pt.k&&"true"===this.Pt.k.autoplay&&this.Pt.start()},this.s.onclose=function(){!0===this.Pt.P&&console.log("[WS] wsSocket.onclose",this.Pt),!0===this.Pt.v?!0===this.Pt.P&&console.log("[WS] wsSocket.onclose disconnect"):this.Pt.S=!0;try{this.Pt.Rt(this.Pt)}catch(t){}this.Pt.kt(this.Pt),this.Pt.p="",this.Pt.C=!1}}else!0===this.P&&console.log("[WS] MediaSource API is not available")},H5sPlayerWS.prototype.Rt=function(t){!0===t.P&&console.log("[WS] Cleanup Source Buffer",t);try{Array.from(t.t.sourceBuffers).includes(t.sourceBuffer)&&!t.sourceBuffer.updating&&(t.sourceBuffer.removeEventListener("updateend",t.vt,!1),t.sourceBuffer.abort(),document.documentMode||/Edge/.test(navigator.userAgent)||t.t.removeSourceBuffer(t.sourceBuffer)),t.video.src="",t.video.load(),t.sourceBuffer=null,t.t=null,t.buffer=[]}catch(e){!0===t.P&&console.log(e)}},H5sPlayerWS.prototype.kt=function(t){!0===t.P&&console.log("[WS] CleanupWebSocket",t),clearInterval(t.o),clearInterval(t.i),t.h=0,t.l=0,t.u=0},H5sPlayerWS.prototype.wt=function(){if(void 0===this.k){if(void 0===this.m.Wt);else if("false"==this.m.Wt)return void(!0===this.P&&console.log("[WS] Stream check has been disabled ",this));!0===this.v&&(!0===this.P&&console.log("[WS] CheckSourceBuffer has been disconnect",this),clearInterval(this.o),clearInterval(this.i),clearInterval(this.Et));try{if(!0===this.P&&console.log("[WS] CheckSourceBuffer",this),this.sourceBuffer.buffered.length<=0){if(this.h++,this.h>8)return!0===this.P&&console.log("[WS] CheckSourceBuffer Close 1"),clearInterval(this.o),void this.s.close()}else{this.h=0;this.sourceBuffer.buffered.start(0);var t=this.sourceBuffer.buffered.end(0),e=t-this.video.currentTime;if(e>5)return!0===this.P&&console.log("[WS] CheckSourceBuffer Close 2",e),clearInterval(this.o),void this.s.close();if(t==this.l){if(this.u++,this.u>3)return!0===this.P&&console.log("[WS] CheckSourceBuffer Close 3"),clearInterval(this.o),void this.s.close()}else this.u=0;this.l=t}}catch(t){!0===this.P&&console.log(t),clearInterval(this.o),this.s.close()}}},H5sPlayerWS.prototype.connect=function(){this.ft(this.W),this.Et=setInterval(this.ut.bind(this),800)},H5sPlayerWS.prototype.disconnect=function(){!0===this.P&&console.log("[WS] disconnect",this),this.v=!0,clearInterval(this.Et);try{null!=this.s&&(this.video.src="",this.s.close(),this.s=null)}catch(t){}!0===this.P&&console.log("[WS] disconnect",this)},H5sPlayerWS.prototype.start=function(){try{var t={cmd:"H5_START"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerWS.prototype.pause=function(){try{var t={cmd:"H5_PAUSE"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerWS.prototype.resume=function(){try{var t={cmd:"H5_RESUME"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerWS.prototype.seek=function(t){try{var e={cmd:"H5_SEEK"};e.nSeekTime=t,this.s.send(JSON.stringify(e))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerWS.prototype.moveto=function(t){try{var e={cmd:"H5_MOVETO"};e.strMovetoTime=t,this.s.send(JSON.stringify(e))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerWS.prototype.speed=function(t){try{var e={cmd:"H5_SPEED"};e.nSpeed=t,this.s.send(JSON.stringify(e))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerRTC.prototype.ut=function(){if(!0===this.S){!0===this.P&&console.log("[RTC] Reconnect...");var t=this.A+"&update="+this.H;this.T.setAttribute("poster",t),!0===this.P&&console.log("[RTC] Reconnect image",t),this.H++,this.ft(this.W),this.S=!1}},H5sPlayerRTC.prototype.St=function(t){var e;!0===this.P&&console.log("[RTC] H5SWebSocketClient");try{"http:"==this.m.protocol&&(e="undefined"!=typeof MozWebSocket?new MozWebSocket("ws://"+this.m.host+t):new WebSocket("ws://"+this.m.host+t)),"https:"==this.m.protocol&&(!0===this.P&&console.log(this.m.host),e="undefined"!=typeof MozWebSocket?new MozWebSocket("wss://"+this.m.host+t):new WebSocket("wss://"+this.m.host+t)),!0===this.P&&console.log(this.m.host)}catch(t){return void alert("WebSocketClient error")}return e},H5sPlayerRTC.prototype.Ct=function(){try{var t={type:"keepalive"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerRTC.prototype.Tt=function(t){if(t.candidate){var e;!0===this.P&&console.log("[RTC] onIceCandidate currentice",t.candidate),e=t.candidate,!0===this.P&&console.log("[RTC] onIceCandidate currentice",JSON.stringify(e));var s=JSON.parse(JSON.stringify(e));s.type="remoteice",!0===this.P&&console.log("[RTC] onIceCandidate currentice new",JSON.stringify(s)),this.s.send(JSON.stringify(s))}else!0===this.P&&console.log("End of candidates.")},H5sPlayerRTC.prototype.It=function(t){if(!0===this.P&&console.log("[RTC] Remote track added:"+JSON.stringify(t.track.kind)),this.F.addTrack(t.track),"audio"!=t.track.kind){var e=this.T;e.srcObject=this.F,e.play()}},H5sPlayerRTC.prototype.bt=function(){!0===this.P&&console.log("[RTC] createPeerConnection  config: "+JSON.stringify(this.O)+" option:"+JSON.stringify(this.M));var t=new RTCPeerConnection(this.O,this.M),e=this;return t.onicecandidate=function(t){e.Tt.call(e,t)},t.ontrack=function(t){e.It.call(e,t)},t.oniceconnectionstatechange=function(s){!0===e.P&&console.log("[RTC] oniceconnectionstatechange  state: "+t.iceConnectionState)},!0===this.P&&console.log("[RTC] Created RTCPeerConnnection with config: "+JSON.stringify(this.O)+"option:"+JSON.stringify(this.M)),t},H5sPlayerRTC.prototype.At=function(t){!0===this.P&&console.log("[RTC] ProcessRTCOffer",t);try{this.g=this.bt(),this.N.length=0;var e=this;!0===this.P&&console.log("[RTC] createRTCSessionDescription "),this.g.setRemoteDescription(createRTCSessionDescription(t)),this.g.createAnswer(this.U).then(function(t){!0===e.P&&console.log("[RTC] Create answer:"+JSON.stringify(t)),e.g.setLocalDescription(t,function(){!0===e.P&&console.log("[RTC] ProcessRTCOffer createAnswer",t),e.s.send(JSON.stringify(t))},function(){})},function(t){alert("[RTC] Create awnser error:"+JSON.stringify(t))})}catch(t){this.disconnect(),alert("[RTC] connect error: "+t)}},H5sPlayerRTC.prototype.gt=function(t){!0===this.P&&console.log("[RTC] ProcessRemoteIce",t);try{var e=new RTCIceCandidate({sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate});!0===this.P&&console.log("[RTC] ProcessRemoteIce",e),!0===this.P&&console.log("[RTC] Adding ICE candidate :"+JSON.stringify(e)),this.g.addIceCandidate(e,function(){},function(t){console.log("[RTC] addIceCandidate error:"+JSON.stringify(t))})}catch(t){alert("connect ProcessRemoteIce error: "+t)}},H5sPlayerRTC.prototype.pt=function(t){t.data,ArrayBuffer,t.data,!0===this.P&&console.log("[RTC] RTC received ",t.data);var e=JSON.parse(t.data);return!0===this.P&&console.log("[RTC] Get Message type ",e.type),"offer"===e.type?(!0===this.P&&console.log("[RTC] Process Message type ",e.type),void this.At(e)):"iceserver"===e.type?(!0===this.P&&console.log("[RTC] Process Message type ",e.type),this.O.iceServers=e.iceServers,this.O.iceTransportPolicy=e.iceTransportPolicy,void(!0===this.P&&console.log("[RTC] Iceserver:",this.O))):"remoteice"===e.type?(!0===this.P&&console.log("[RTC] Process Message type ",e.type),void this.gt(e)):void(void 0!=this.k&&void 0!=this.k.callback&&this.k.callback(t.data,this.k.userdata))},H5sPlayerRTC.prototype.ft=function(t){this.video.autoplay=!0;var e="api/v1/h5srtcapi";void 0===this.m.rtcengine||"v2"===this.m.rtcengine&&(e="api/v1/h5srtcapi2"),!0===this.P&&console.log("[RTC] API path",e);var s="main";void 0===this.m.streamprofile||(s=this.m.streamprofile);var i="false",o='video/mp4; codecs="hev1.1.6.L93.B0, mp4a.40.2"';if("MediaSource"in window&&MediaSource.isTypeSupported(o)?1==gH5SIsWebrtcH265ReceiveCodecSupported&&(i="true"):(!0===this.P&&console.log("[RTC] Unsupported MIME type or codec: ",o),i="false"),void 0===this.k)e=this.m.rootpath+e+"?token="+t+"&hevc="+i+"&profile="+s+"&session="+this.m.session;else{var n="false",h="fake";void 0===this.k.serverpb||(n=this.k.serverpb),void 0===this.k.filename||(h=this.k.filename);var c=this.k.begintime;void 0===this.k.moveto||(c=this.k.moveto),e=this.m.rootpath+e+"?token="+t+"&playback=true&hevc="+i+"&profile="+s+"&serverpb="+n+"&begintime="+encodeURIComponent(this.k.begintime)+"&endtime="+encodeURIComponent(this.k.endtime)+"&moveto="+encodeURIComponent(c)+"&filename="+h+"&session="+this.m.session}!0===this.P&&console.log(e),this.s=this.St(e),!0===this.P&&console.log("[RTC] setupWebSocket",this.s),this.s.binaryType="arraybuffer",this.s.Pt=this,this.s.onmessage=this.pt.bind(this),this.s.onopen=function(){!0===this.Pt.P&&console.log("[RTC] wsSocket.onopen",this.Pt);var t={type:"open"};this.Pt.s.send(JSON.stringify(t)),this.Pt.o=setInterval(this.Pt.Ct.bind(this.Pt),1e3),void 0!=this.Pt.k&&"true"===this.Pt.k.autoplay&&this.Pt.start()},this.s.onclose=function(){!0===this.P&&console.log("[RTC] wsSocket.onclose",this.Pt),!0===this.Pt.v?!0===this.Pt.P&&console.log("[RTC] wsSocket.onclose disconnect"):this.Pt.S=!0,this.Pt.kt(this.Pt)}},H5sPlayerRTC.prototype.kt=function(t){!0===t.P&&console.log("[RTC] CleanupWebSocket",t),clearInterval(t.o)},H5sPlayerRTC.prototype.connect=function(){this.ft(this.W),this.Et=setInterval(this.ut.bind(this),3e3)},H5sPlayerRTC.prototype.disconnect=function(){if(!0===this.P&&console.log("[RTC] disconnect",this),this.v=!0,clearInterval(this.Et),null!=this.s&&(this.s.close(),this.s=null),this.T&&(this.T.src=""),this.g){try{this.g.close()}catch(t){!0===this.P&&console.log("[RTC] close peer connection failed:"+t)}this.g=null}!0===this.P&&console.log("[RTC] disconnect",this)},H5sPlayerRTC.prototype.start=function(){try{var t={cmd:"H5_START"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerRTC.prototype.pause=function(){try{var t={cmd:"H5_PAUSE"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerRTC.prototype.resume=function(){try{var t={cmd:"H5_RESUME"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerRTC.prototype.seek=function(t){try{var e={cmd:"H5_SEEK"};e.nSeekTime=t,this.s.send(JSON.stringify(e))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerRTC.prototype.moveto=function(t){try{var e={cmd:"H5_MOVETO"};e.strMovetoTime=t,this.s.send(JSON.stringify(e))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerRTC.prototype.speed=function(t){try{var e={cmd:"H5_SPEED"};e.nSpeed=t,this.s.send(JSON.stringify(e))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerHls.prototype.St=function(t){var e;!0===this.P&&console.log("[HLS] H5SWebSocketClient");try{"http:"==this.m.protocol&&(e="undefined"!=typeof MozWebSocket?new MozWebSocket("ws://"+this.m.host+t):new WebSocket("ws://"+this.m.host+t)),"https:"==this.m.protocol&&(!0===this.P&&console.log("[HLS] ",this.m.host),e="undefined"!=typeof MozWebSocket?new MozWebSocket("wss://"+this.m.host+t):new WebSocket("wss://"+this.m.host+t)),!0===this.P&&console.log(this.m.host)}catch(t){return void alert("WebSocketClient error")}return e},H5sPlayerHls.prototype.Ct=function(){try{var t={type:"keepalive"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sPlayerHls.prototype.pt=function(t){!0===this.P&&console.log("[HLS] HLS received ",t.data)},H5sPlayerHls.prototype.ft=function(t){var e="api/v1/h5swscmnapi";e=this.m.rootpath+e+"?token="+t+"&session="+this.m.session,!0===this.P&&console.log(e),this.s=this.St(e),!0===this.P&&console.log("[HLS] setupWebSocket",this.s),this.s.binaryType="arraybuffer",this.s.Pt=this,this.s.onmessage=this.pt.bind(this),this.s.onopen=function(){!0===this.Pt.P&&console.log("[HLS] wsSocket.onopen",this.Pt),this.Pt.o=setInterval(this.Pt.Ct.bind(this.Pt),1e3)},this.s.onclose=function(){!0===this.Pt.P&&console.log("[HLS] wsSocket.onclose",this.Pt),this.Pt.kt(this.Pt)}},H5sPlayerHls.prototype.kt=function(t){!0===t.P&&console.log("[HLS] H5sPlayerHls CleanupWebSocket",t),clearInterval(t.o)},H5sPlayerHls.prototype.Mt=function(){!0===this.P&&console.log("[HLS]  video.ended",this.D.ended),!0===this.P&&console.log("[HLS] video.currentTime",this.D.currentTime);var t=this.D.currentTime,e=t-this.L;!0===this.P&&console.log("[HLS]  diff",e),0===e&&this.B++,this.L=t,this.B>3&&(null!=this.s&&(this.s.close(),this.s=null),this.ft(this.W),!0===this.P&&console.log("[HLS] reconnect"),this.D.src="",this.L=0,this.B=0,this.D.src=this.m.protocol+"//"+this.m.host+this.m.rootpath+"hls/"+this._+"/"+this.W+"/hls.m3u8",this.D.play())},H5sPlayerHls.prototype.connect=function(){this.ft(this.W),this.L=0,this.B=0,this.D.onended=function(t){!0===this.P&&console.log("[HLS] The End")},this.D.onpause=function(t){!0===this.P&&console.log("[HLS] Pause")},this.D.onplaying=function(t){!0===this.P&&console.log("[HLS] Playing")},this.D.onseeking=function(t){!0===this.P&&console.log("[HLS] seeking")},this.D.onvolumechange=function(t){!0===this.P&&console.log("[HLS] volumechange")},this.D.src=this.m.protocol+"//"+this.m.host+this.m.rootpath+"hls/"+this._+"/"+this.W+"/hls.m3u8",this.D.play(),this.J=setInterval(this.Mt.bind(this),3e3)},H5sPlayerHls.prototype.disconnect=function(){clearInterval(this.J),this.L=0,this.B=0,null!=this.s&&(this.s.close(),this.s=null),!0===this.P&&console.log("[HLS] disconnect",this)},H5sPlayerAudio.prototype.St=function(t){var e;!0===this.P&&console.log("[AUD] H5SWebSocketClient");try{"http:"==this.m.protocol&&(e="undefined"!=typeof MozWebSocket?new MozWebSocket("ws://"+this.m.host+t):new WebSocket("ws://"+this.m.host+t)),"https:"==this.m.protocol&&(!0===this.P&&console.log(this.m.host),e="undefined"!=typeof MozWebSocket?new MozWebSocket("wss://"+this.m.host+t):new WebSocket("wss://"+this.m.host+t)),!0===this.P&&console.log(this.m.host)}catch(t){return void alert("WebSocketClient error")}return e},H5sPlayerAudio.prototype.Ct=function(){try{this.s.send("keepalive")}catch(t){!0===this.P&&console.log(t)}},H5sPlayerAudio.prototype.pt=function(t){for(var e=new Int16Array(t.data),s=e.length,i=this.V.createBuffer(1,s,8e3),o=0;o<1;o++)for(var n=i.getChannelData(o),h=0;h<s;h++)n[h]=e[h]/16383.5;var c=this.V.createBufferSource();c.buffer=i,c.connect(this.V.destination),c.start()},H5sPlayerAudio.prototype.kt=function(t){!0===t.P&&console.log("[AUD] CleanupWebSocket",t),clearInterval(t.o)},H5sPlayerAudio.prototype.ft=function(t){var e="api/v1/h5saudapi";e=this.m.rootpath+e+"?token="+t+"&session="+this.m.session,!0===this.P&&console.log(e),this.s=this.St(e),!0===this.P&&console.log("[AUD] setupWebSocket for audio",this.s),this.s.binaryType="arraybuffer",this.s.Pt=this,this.s.onmessage=this.pt.bind(this),this.s.onopen=function(){!0===this.Pt.P&&console.log("[AUD] wsSocket.onopen",this.Pt),this.Pt.o=setInterval(this.Pt.Ct.bind(this.Pt),1e3)},this.s.onclose=function(){!0===this.Pt.P&&console.log("[AUD] wsSocket.onclose",this.Pt),this.Pt.kt(this.Pt)}},H5sPlayerAudio.prototype.connect=function(){this.ft(this.W)},H5sPlayerAudio.prototype.disconnect=function(){!0===this.P&&console.log("[AUD] disconnect",this),null!=this.s&&(this.s.close(),this.s=null),!0===this.P&&console.log("[AUD] disconnect",this)},H5sPlayerAudBack.prototype.St=function(t){var e;!0===this.P&&console.log("[AUDBACK] H5SWebSocketClient");try{"http:"==this.m.protocol&&(e="undefined"!=typeof MozWebSocket?new MozWebSocket("ws://"+this.m.host+t):new WebSocket("ws://"+this.m.host+t)),"https:"==this.m.protocol&&(!0===this.P&&console.log(this.m.host),e="undefined"!=typeof MozWebSocket?new MozWebSocket("wss://"+this.m.host+t):new WebSocket("wss://"+this.m.host+t)),!0===this.P&&console.log(this.m.host)}catch(t){return void alert("WebSocketClient error")}return e},H5sPlayerAudBack.prototype.Ct=function(){try{this.s.send("keepalive")}catch(t){!0===this.P&&console.log(t)}},H5sPlayerAudBack.prototype.pt=function(t){},H5sPlayerAudBack.prototype.kt=function(t){!0===this.P&&console.log("[AUDBACK] CleanupWebSocket",t),clearInterval(t.o)},H5sPlayerAudBack.prototype.X=function(){!0===this.P&&console.log("[AUDBACK] sampleRate",this.V.sampleRate),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.Ut;try{navigator.getUserMedia({video:!1,audio:!0},this.Ot.bind(this))}catch(e){var t="[AUDBACK] Audio back getUserMedia failed: "+e.name+" "+e.message;return void alert(t)}},H5sPlayerAudBack.prototype.Nt=function(){this.Z=!0},H5sPlayerAudBack.prototype.ft=function(t){var e="api/v1/h5saudbackapi";e=this.m.rootpath+e+"?token="+t+"&samplerate="+this.G+"&session="+this.m.session,!0===this.P&&console.log(e),this.s=this.St(e),!0===this.P&&console.log("[AUDBACK] setupWebSocket for audio back",this.s),this.s.binaryType="arraybuffer",this.s.Pt=this,this.s.onmessage=this.pt.bind(this),this.s.onopen=this.Nt.bind(this),this.s.onclose=function(){!0===this.P&&console.log("[AUDBACK] wsSocket.onclose",this.Pt),this.Pt.kt(this.Pt)}},H5sPlayerAudBack.prototype.Ft=function(t){var e=float32ToInt16(t.inputBuffer.getChannelData(0));!0===this.Z&&this.s&&this.s.send(e)},H5sPlayerAudBack.prototype.Ot=function(t){try{var e=this.V.createMediaStreamSource(t),s=this.V.createScriptProcessor(1024,1,1);e.connect(s),s.connect(this.V.destination),s.onaudioprocess=this.Ft.bind(this)}catch(t){return void alert("Audio intecomm error",t)}},H5sPlayerAudBack.prototype.connect=function(){this.ft(this.W)},H5sPlayerAudBack.prototype.disconnect=function(){!0===this.P&&console.log("[AUDBACK] disconnect",this),null!=this.s&&(this.s.close(),this.s=null),!0===this.P&&console.log("[AUDBACK] disconnect",this)},H5sConference.prototype.ut=function(){!0===this.S&&(!0===this.P&&console.log("Reconnect..."),this.ft(this.W),this.S=!1)},H5sConference.prototype.St=function(t){var e;!0===this.P&&console.log("[CFE] H5SWebSocketClient");try{"http:"==this.m.protocol&&(e="undefined"!=typeof MozWebSocket?new MozWebSocket("ws://"+this.m.host+t):new WebSocket("ws://"+this.m.host+t)),"https:"==this.m.protocol&&(!0===this.P&&console.log(this.m.host),e="undefined"!=typeof MozWebSocket?new MozWebSocket("wss://"+this.m.host+t):new WebSocket("wss://"+this.m.host+t)),!0===this.P&&console.log(this.m.host)}catch(t){return void alert("WebSocketClient error")}return e},H5sConference.prototype.Ct=function(){try{var t={type:"CFE_CMD_KEEPALIVE"},e={};e.strId=this.j,t.keepalive=e,this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sConference.prototype.Tt=function(t){if(t.candidate){var e;!0===this.P&&console.log("[CFE] onIceCandidate currentice",t.candidate),e=t.candidate,!0===this.P&&console.log("[CFE] onIceCandidate currentice",JSON.stringify(e));var s={type:"CFE_CMD_REMOTE_ICE"},i={};console.log("[CFE] remote Ice to",this.q),i.strTo=this.q,i.msg=e,s.remoteIce=i,this.s.send(JSON.stringify(s))}else!0===this.P&&console.log("[CFE] End of candidates.")},H5sConference.prototype.Jt=function(t){!0===this.P&&console.log("[CFE] ondataavailableLocal",t.data),this.it.push(t.data),"inactive"==this.et.state&&makeLink(this.it,"local",".webm")},H5sConference.prototype._t=function(t){!0===this.P&&console.log("[CFE] ondataavailableRemote",t.data),this.ot.push(t.data),"inactive"==this.st.state&&makeLink(this.ot,"remote",".webm")},H5sConference.prototype.It=function(t){var e;!0===this.P&&console.log("[CFE] Remote track added:"+JSON.stringify(t)),e=t.Dt?t.Dt[0]:t.stream;var s=this.rt;if(s.srcObject!==e){s.srcObject=e,s.play();try{1==this.$&&(!0===this.P&&console.log("[CFE] Start local record..."),this.et=new MediaRecorder(this.xt),this.et.ondataavailable=this.Jt.bind(this),this.et.start()),1==this.tt&&(!0===this.P&&console.log("[CFE] Start remote record..."),this.st=new MediaRecorder(e),this.st.ondataavailable=this._t.bind(this),this.st.start())}catch(t){alert("start record error: "+t)}}},H5sConference.prototype.bt=function(){!0===this.P&&console.log("[CFE] createPeerConnection  config: "+JSON.stringify(this.O)+" option:"+JSON.stringify(this.M));var t=new RTCPeerConnection(this.O,this.M),e=this;return t.onicecandidate=function(t){e.Tt.call(e,t)},void 0!==t.ontrack?t.ontrack=function(t){e.It.call(e,t)}:t.onaddstream=function(t){e.It.call(e,t)},t.oniceconnectionstatechange=function(e){!0===this.P&&console.log("[CFE] oniceconnectionstatechange  state: "+t.iceConnectionState)},!0===this.P&&console.log("[CFE] Created RTCPeerConnnection with config: "+JSON.stringify(this.O)+"option:"+JSON.stringify(this.M)),t},H5sConference.prototype.Lt=function(t){!0===this.P&&console.log("[CFE] ProcessOffer",t);try{this.g=this.bt(),this.N.length=0;var e=this;const s=this.xt.getVideoTracks(),i=this.xt.getAudioTracks();s.length>0&&console.log("[CFE] Using video device:",s[0].label),i.length>0&&console.log("[CFE] Using audio device:",i[0].label),this.xt.getTracks().forEach(t=>this.g.addTrack(t,this.xt)),!0===this.P&&console.log("[CFE] createRTCSessionDescription "),this.g.setRemoteDescription(createRTCSessionDescription(t)),this.g.createAnswer(this.U).then(function(t){!0===e.P&&console.log("[CFE] Create answer:"+JSON.stringify(t)),e.g.setLocalDescription(t,function(){!0===e.P&&console.log("[CFE] ProcessOffer createAnswer",t);var s={type:"CFE_CMD_CALL_ANSWER"},i={};console.log("[CFE] createAnswer to",e.q),i.strTo=e.q,i.msg=t,s.answer=i,e.s.send(JSON.stringify(s))},function(){})},function(t){alert("[CFE ]Create awnser error:"+JSON.stringify(t))})}catch(t){this.disconnect(),alert("connect error: "+t)}},H5sConference.prototype.Bt=function(t){!0===this.P&&console.log("[CFE] ProcessAnswer",t);try{this.g.setRemoteDescription(createRTCSessionDescription(t))}catch(t){this.disconnect(),alert("connect error: "+t)}},H5sConference.prototype.zt=function(){!0===this.P&&console.log("[CFE] CreateOffer");try{this.g=this.bt(),this.N.length=0;var t=this;const e=this.xt.getVideoTracks(),s=this.xt.getAudioTracks();return e.length>0&&console.log("[CFE] Using video device:",e[0].label),s.length>0&&console.log("[CFE] Using audio device:",s[0].label),this.xt.getTracks().forEach(t=>this.g.addTrack(t,this.xt)),void this.g.createOffer(this.U).then(function(e){!0===t.P&&console.log("[CFE] Create answer:"+JSON.stringify(e)),t.g.setLocalDescription(e,function(){!0===t.P&&console.log("[CFE] ProcessOffer createAnswer",e);var s=e;!0===t.P&&console.log("[CFE] createOffer ",JSON.stringify(s));var i={type:"CFE_CMD_CALL_OFFER"},o={};!0===t.P&&console.log("[CFE] createOffer to",t.q),o.strTo=t.q,o.msg=s,i.offer=o,t.s.send(JSON.stringify(i))},function(){})},function(t){alert("[CFE ]Create offer error:"+JSON.stringify(t))})}catch(t){this.disconnect(),alert("connect error: "+t)}},H5sConference.prototype.gt=function(t){!0===this.P&&console.log("[CFE] ProcessRemoteIce",t);try{var e=new RTCIceCandidate({sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate});!0===this.P&&console.log("[CFE] ProcessRemoteIce",e),!0===this.P&&console.log("[CFE] Adding ICE candidate :"+JSON.stringify(e)),this.g.addIceCandidate(e,function(){},function(t){console.log("[CFE] addIceCandidate error:"+JSON.stringify(t))})}catch(t){alert("connect ProcessRemoteIce error: "+t)}},H5sConference.prototype.pt=function(t){!0===this.P&&console.log("[CFE] received ",t.data);var e=JSON.parse(t.data);if(!0===this.P&&console.log("[CFE] Get Message type ",e.type),"CFE_CMD_INVITE_REQ"!==e.type){if("CFE_CMD_INVITE_RESP"===e.type)return this.q=e.inviteResp.strFrom,void this.zt();if("CFE_CMD_CALL_OFFER"!==e.type)if("CFE_CMD_CALL_ANSWER"!==e.type)if("CFE_CMD_REMOTE_ICE"!==e.type){if("CFE_EVENT_ID_ASSIGN"===e.type){this.j=e.idAssign.strId,1==e.idAssign.bEnableRelay&&(this.O.iceServers=e.idAssign.iceServers,this.O.iceTransportPolicy=e.idAssign.iceTransportPolicy,!0===this.P&&console.log("[CFE] Iceserver:",this.O));var s={type:"CFE_EVENT_ID_ASSIGN",idAssign:{}};return s.idAssign.strId=e.idAssign.strId,void(void 0!=this.m.callback&&this.m.callback(JSON.stringify(s),this.m.userdata))}void 0!=this.m.callback&&this.m.callback(t.data,this.m.userdata)}else this.gt(e.remoteIce.msg);else this.Bt(e.answer.msg);else this.Lt(e.offer.msg)}},H5sConference.prototype.ft=function(t){this.ct.autoplay=!0,this.rt.autoplay=!0;var e="api/v1/h5sconference";e=void 0===this.j?this.m.rootpath+e+"?name="+this.m.user+"&session="+this.m.session:this.m.rootpath+e+"?name="+this.m.user+"?id="+this.j+"&session="+this.m.session,!0===this.P&&console.log(e),this.s=this.St(e),!0===this.P&&console.log("[CFE] setupWebSocket",this.s),this.s.binaryType="arraybuffer",this.s.Pt=this,this.s.onmessage=this.pt.bind(this),this.s.onopen=function(){!0===this.Pt.P&&console.log("[CFE] wsSocket.onopen",this.Pt),this.Pt.o=setInterval(this.Pt.Ct.bind(this.Pt),1e3),void 0!=this.Pt.k&&"true"===this.Pt.k.autoplay&&this.Pt.start()},this.s.onclose=function(){!0===this.Pt.P&&console.log("[CFE] wsSocket.onclose",this.Pt),!0===this.Pt.v?!0===this.Pt.P&&console.log("[CFE] wsSocket.onclose disconnect"):this.Pt.S=!0,this.Pt.kt(this.Pt)}},H5sConference.prototype.kt=function(t){!0===t.P&&console.log("[CFE] CleanupWebSocket",t),clearInterval(t.o)},H5sConference.prototype.connect=function(){this.ft(this.W),this.Et=setInterval(this.ut.bind(this),3e3)},H5sConference.prototype.call=function(t,e,s,i,o){if(1!=this.Y){this.Vt=s,this.Kt=o,this.Gt=i;var n=1280,h=720;"QVGA"==i?(n=320,h=240):"VGA"==i?(n=640,h=480):"D1"==i?(n=720,h=576):"720P"==i?(n=1280,h=720):"1080P"==i?(n=1920,h=1080):"4K"==i?(n=4096,h=2160):"8K"==i&&(n=7680,h=4320);try{try{var c;c=0!=t&&{deviceId:{exact:s},width:{exact:n},height:{exact:h}};var r=this;navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:o}},video:c}).then(function(s){1==t&&(r.ct.srcObject=s),r.xt=s;var i={type:"CFE_CMD_INVITE_REQ"},o={};o.strFrom=r.j,o.strTo=e,i.inviteReq=o,r.s.send(JSON.stringify(i))}).catch(function(t){var e="[CFE] getUserMedia failed: "+t.name+" "+t.message;alert(e)})}catch(t){var a="[CFE] getUserMedia failed: "+err.name+" "+err.message;alert(a)}}catch(t){!0===this.P&&console.log(t)}this.Y=!0}},H5sConference.prototype.answer=function(t,e,s,i,o){if(1!=this.Y){this.Vt=s,this.Kt=o,this.Gt=i;var n=1280,h=720;"QVGA"==i?(n=320,h=240):"VGA"==i?(n=640,h=480):"D1"==i?(n=720,h=576):"720P"==i?(n=1280,h=720):"1080P"==i?(n=1920,h=1080):"4K"==i?(n=4096,h=2160):"8K"==i&&(n=7680,h=4320);try{try{var c;c=0!=t&&{deviceId:{exact:s},width:{exact:n},height:{exact:h}};var r=this;navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:o}},video:c}).then(function(s){1==t&&(r.ct.srcObject=s),r.xt=s;var i={type:"CFE_CMD_INVITE_RESP"},o={};o.strFrom=r.j,o.strTo=e,r.q=e,i.inviteResp=o,r.s.send(JSON.stringify(i))}).catch(function(t){var e="[CFE] getUserMedia failed: "+t.name+" "+t.message;alert(e)})}catch(t){var a="[CFE] getUserMedia failed: "+err.name+" "+err.message;alert(a)}}catch(t){!0===this.P&&console.log(t)}this.Y=!0}},H5sConference.prototype.hangup=function(){if(0!=this.Y){try{1==this.$&&this.et.stop(),1==this.tt&&this.st.stop()}catch(t){alert("stop record error: "+t)}try{var t={cmd:"H5_PAUSE"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}if(this.ct&&(this.ct.src=""),this.rt&&(this.rt.src=""),this.xt&&(this.xt=null),this.g){try{this.g.close()}catch(t){!0===this.P&&console.log("[CFE] close peer connection failed:"+t)}this.g=null}this.Y=!1}},H5sConference.prototype.disconnect=function(){!0===this.P&&console.log("[CFE] disconnect",this),this.v=!0,clearInterval(this.Et),this.hangup(),null!=this.s&&(this.s.close(),this.s=null),!0===this.P&&console.log("[CFE] disconnect",this)},H5sRTCPush.prototype.ut=function(){!0===this.S&&(!0===this.P&&console.log("[PUSH] Reconnect..."),this.ft(this.lt),this.S=!1)},H5sRTCPush.prototype.St=function(t){var e;!0===this.P&&console.log("[PUSH] H5SWebSocketClient");try{"http:"==this.m.protocol&&(e="undefined"!=typeof MozWebSocket?new MozWebSocket("ws://"+this.m.host+t):new WebSocket("ws://"+this.m.host+t)),"https:"==this.m.protocol&&(!0===this.P&&console.log(this.m.host),e="undefined"!=typeof MozWebSocket?new MozWebSocket("wss://"+this.m.host+t):new WebSocket("wss://"+this.m.host+t)),!0===this.P&&console.log(this.m.host)}catch(t){return void alert("WebSocketClient error")}return e},H5sRTCPush.prototype.Ct=function(){try{var t={type:"keepalive"};this.s.send(JSON.stringify(t))}catch(t){!0===this.P&&console.log(t)}},H5sRTCPush.prototype.Tt=function(t){if(t.candidate){var e;!0===this.P&&console.log("[PUSH] onIceCandidate currentice",t.candidate),e=t.candidate,!0===this.P&&console.log("[PUSH] onIceCandidate currentice",JSON.stringify(e));var s=JSON.parse(JSON.stringify(e));s.type="remoteice",!0===this.P&&console.log("[PUSH] onIceCandidate currentice new",JSON.stringify(s)),this.s.send(JSON.stringify(s))}else!0===this.P&&console.log("End of candidates.")},H5sRTCPush.prototype.It=function(t){!0===this.P&&console.log("[PUSH] Remote track added:"+JSON.stringify(t)),t.Dt?t.Dt[0]:t.stream},H5sRTCPush.prototype.bt=function(){!0===this.P&&console.log("[PUSH] createPeerConnection  config: "+JSON.stringify(this.O)+" option:"+JSON.stringify(this.M));var t=new RTCPeerConnection(this.O,this.M),e=this;return t.onicecandidate=function(t){e.Tt.call(e,t)},void 0!==t.ontrack?t.ontrack=function(t){e.It.call(e,t)}:t.onaddstream=function(t){e.It.call(e,t)},t.oniceconnectionstatechange=function(s){!0===e.P&&console.log("[PUSH] oniceconnectionstatechange  state: "+t.iceConnectionState)},!0===this.P&&console.log("[PUSH] Created RTCPeerConnnection with config: "+JSON.stringify(this.O)+"option:"+JSON.stringify(this.M)),t},H5sRTCPush.prototype.Qt=function(t,e){if(("chrome"===adapter.browserDetails.browser||"safari"===adapter.browserDetails.browser||"firefox"===adapter.browserDetails.browser&&adapter.browserDetails.version>=64)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){const s=t.getSenders();for(let t=0;t!==s.length;++t){const i=s[t];if("video"==i.track.kind){const t=i.getParameters();t.encodings||(t.encodings=[{}]),t.encodings[0].maxBitrate=1e3*e,i.setParameters(t).then(()=>{}).catch(t=>console.error(t))}}}},H5sRTCPush.prototype.zt=function(){!0===this.P&&console.log("[PUSH] CreateOffer");try{this.g=this.bt(),this.N.length=0;var t=this;const i=this.xt.getVideoTracks(),o=this.xt.getAudioTracks();if(i.length>0&&console.log("[PUSH] Using video device:",i[0].label),o.length>0&&console.log("[PUSH] Using audio device:",o[0].label),this.xt.getTracks().forEach(t=>this.g.addTrack(t,this.xt)),window.RTCRtpTransceiver&&"setCodecPreferences"in window.RTCRtpTransceiver.prototype){var e="video/H264";"VP9"==this.Zt?e="video/VP9":"H264"==this.Zt&&(e="video/H264");const i=window.RTCRtpSender.getCapabilities("video").codecs;var s=[];for(let t=0;t!==i.length;++t){const o=i[t];[e].includes(o.mimeType)&&s.push(o)}!0===t.P&&console.log("[PUSH] Select codec:",s),this.g.getTransceivers().find(t=>t.sender&&t.sender.track===this.xt.getVideoTracks()[0]).setCodecPreferences(s)}return void this.g.createOffer(this.U).then(function(e){!0===t.P&&console.log("[PUSH] Create offer:"+JSON.stringify(e)),t.g.setLocalDescription(e,function(){var s=e;t.s.send(JSON.stringify(s))},function(){})},function(t){alert("[PUSH ]Create offer error:"+JSON.stringify(t))})}catch(t){this.disconnect(),alert("connect error: "+t)}},H5sRTCPush.prototype.Bt=function(t){!0===this.P&&console.log("[PUSH] ProcessAnswer",t);try{this.g.setRemoteDescription(createRTCSessionDescription(t))}catch(t){this.disconnect(),alert("connect error: "+t)}this.Qt(this.g,this.Xt)},H5sRTCPush.prototype.gt=function(t){!0===this.P&&console.log("[PUSH] ProcessRemoteIce",t);try{var e=new RTCIceCandidate({sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate});!0===this.P&&console.log("[PUSH] ProcessRemoteIce",e),!0===this.P&&console.log("[PUSH] Adding ICE candidate :"+JSON.stringify(e)),this.g.addIceCandidate(e,function(){},function(t){console.log("[PUSH] addIceCandidate error:"+JSON.stringify(t)),console.log(t)})}catch(t){alert("connect ProcessRemoteIce error: "+t)}},H5sRTCPush.prototype.pt=function(t){t.data,ArrayBuffer,t.data,!0===this.P&&console.log("[PUSH] RTC received ",t.data);var e=JSON.parse(t.data);return!0===this.P&&console.log("[PUSH] Get Message type ",e.type),"iceserver"===e.type?(!0===this.P&&console.log("[PUSH] Process Message type ",e.type),this.O.iceServers=e.iceServers,!0===this.P&&console.log("[PUSH] Iceserver:",this.O),void this.zt()):"answer"===e.type?(!0===this.P&&console.log("[PUSH] Process Message type ",e.type),void this.Bt(e)):"remoteice"===e.type?(!0===this.P&&console.log("[PUSH] Process Message type ",e.type),void this.gt(e)):void(void 0!=this.m.callback&&this.m.callback(t.data,this.m.userdata))},H5sRTCPush.prototype.ft=function(t){this.video.autoplay=!0;var e="api/v1/h5srtcpushapi";e=this.m.rootpath+e+"?token="+t+"&type="+this.m.type+"&audio="+this.m.audio+"&session="+this.m.session,!0===this.P&&console.log(e),this.s=this.St(e),!0===this.P&&console.log("[PUSH] setupWebSocket",this.s),this.s.binaryType="arraybuffer",this.s.Pt=this,this.s.onmessage=this.pt.bind(this),this.s.onopen=function(){!0===this.Pt.P&&console.log("[PUSH] wsSocket.onopen",this.Pt);var t={type:"open"};this.Pt.s.send(JSON.stringify(t)),this.Pt.o=setInterval(this.Pt.Ct.bind(this.Pt),1e3),void 0!=this.Pt.k&&"true"===this.Pt.k.autoplay&&this.Pt.start()},this.s.onclose=function(){!0===this.P&&console.log("[PUSH] wsSocket.onclose",this.Pt),!0===this.Pt.v?!0===this.Pt.P&&console.log("[PUSH] wsSocket.onclose disconnect"):this.Pt.S=!0,this.Pt.kt(this.Pt)}},H5sRTCPush.prototype.kt=function(t){!0===t.P&&console.log("[PUSH] CleanupWebSocket",t),clearInterval(t.o)},H5sRTCPush.prototype.connect=function(t,e,s,i,o,n){this.Vt=t,this.Zt=e,this.Xt=s,this.Gt=i,this.Kt=o,!0===this.P&&console.log("[PUSH] videoin:",t,"codec:",e,"bitrate:",s,"resolution:",i,"audioin:",o);var h,c=1280,r=720;"QVGA"==i?(c=320,r=240):"VGA"==i?(c=640,r=480):"D1"==i?(c=720,r=576):"720P"==i?(c=1280,r=720):"1080P"==i?(c=1920,r=1080):"4K"==i?(c=4096,r=2160):"8K"==i&&(c=7680,r=4320);var a="",l=!1;void 0!==this.m.facingmode&&(a=this.m.facingmode,!0===this.P&&console.log("[PUSH] facing mode:",a),l=!0),h="true"==this.m.audio&&{deviceId:{exact:o}};try{const e={audio:h,video:l?{facingMode:{exact:a},width:{exact:c},height:{exact:r}}:{deviceId:{exact:t},width:{exact:c},height:{exact:r}}};try{var d=this;0==n?navigator.mediaDevices.getUserMedia(e).then(function(t){d.dt.srcObject=t,d.xt=t,d.ft(d.lt)}).catch(function(t){var e="[PUSH] getUserMedia failed: "+t.name+" "+t.message;alert(e)}):navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(t){d.dt.srcObject=t,d.xt=t,d.ft(d.lt)}).catch(function(t){alert("[PUSH] getUserMedia failed:",t.name+": "+t.message)})}catch(t){var u="[PUSH] getUserMedia failed: "+err.name+" "+err.message;return void alert(u)}}catch(t){return void(!0===this.P&&console.log(t))}},H5sRTCPush.prototype.send=function(t,e){var s={type:"message"};s.user=this.lt,s.token=t,s.msg=e,this.s.send(JSON.stringify(s))},H5sRTCPush.prototype.disconnect=function(){if(!0===this.P&&console.log("[PUSH] disconnect",this),this.v=!0,clearInterval(this.Et),null!=this.s&&(this.s.close(),this.s=null),this.dt&&(this.dt.src=""),this.g){try{this.g.close()}catch(t){!0===this.P&&console.log("[PUSH] close peer connection failed:"+t)}this.g=null}!0===this.P&&console.log("[PUSH] disconnect",this)};
export  {H5sPlayerWS,H5sPlayerHls,H5sPlayerRTC,H5sPlayerAudBack,H5sConference,H5sRTCPush,H5sRTCGetCapability,H5sGetClientWSDecoder,H5sGetClientRTCDecoder,H5sGetClientRTCInit}